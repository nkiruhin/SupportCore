function TableReady(n,t){return $(".dataTable").DataTable({searching:!0,ordering:!0,order:[],processing:!0,ajax:{url:n},language:{lengthMenu:"Отображать _MENU_ записей",zeroRecords:"Не найдено",info:"Показано с _START_ по _END_ из _TOTAL_ записей",infoFiltered:"(отфильтровано из _MAX_ записей)",infoEmpty:"Нет данных",search:"Фильтр:",processing:"<div data-role='activity' data-type='metro' data-style='dark'><\/div>",paginate:{first:"Первый",last:"Последний",next:"Следующий",previous:"Предыдущий"}},columns:t})}function SimpleTableReady(){return $(".dataTable").DataTable({searching:!0,ordering:!0,processing:!0,order:[[0,"desc"]],language:{lengthMenu:"Отображать _MENU_ записей",zeroRecords:"Не найдено",info:"Показано с _START_ по _END_ из _TOTAL_ записей",infoFiltered:"(отфильтровано из _MAX_ записей)",infoEmpty:"Нет данных",search:"Фильтр:",processing:"Обрабатываю...",paginate:{first:"Первый",last:"Последний",next:"Следующий",previous:"Предидущий"}}})}function edit(n){var t=jQuery(n).parent().parent();t.hasClass("editing")?(t.removeClass("editing"),t.find("DIV.td").each(function(){if(jQuery(this).hasClass("action"))jQuery(this).find("BUTTON").text("edit");else{var n=jQuery(this).find("INPUT").val();jQuery(this).text(n);jQuery(this).find("INPUT").remove()}})):(t.addClass("editing"),t.find("DIV.td").each(function(){if(jQuery(this).hasClass("action"))jQuery(this).find("BUTTON").text("save");else{var n=jQuery(this).text();jQuery(this).text("");jQuery(this).append('<input type="text" value="'+n+'" />')}}))}function openCustomWin(n,t,i,r){$.get(n,function(n){Metro.window.create({title:i,overlay:!0,shadow:!0,modal:r,overlayColor:"#000000",clsCaption:"bg-darkCyan",icon:"<span class='"+t+"'><\/span>",content:n,place:"center"})})}function openCustomDialog(n,t,i){$.get(n,function(n){Metro.dialog.create({title:t+"?",content:n,actions:[{caption:t,cls:"js-dialog-close alert",onclick:function(){i()}},{caption:"Отмена",cls:"js-dialog-close secondary"}]})})}function orgEmail(){var n=document.getElementById("EmailOrg").checked;if(n===!0){if($(".jselect2").find(":selected").length===0){onError("Организация не выбрана");document.getElementById("EmailOrg").checked=!1;return}$("#Email").val($(".jselect2").find(":selected").text().match(/<(.+)>/i)[1]);console.log($(".jselect2").find(":selected").text().match(/<(.+)>/i)[1])}}function getCounters(){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(this.readyState===4&&this.status===200){var n=JSON.parse(this.responseText);for(i in n)document.getElementById(i).innerText=n[i]}};n.open("GET","Tickets/GetTicketCounters",!0);n.send()}function ticketCreate(n){var t=document.forms.TicketCreate;t.addEventListener("submit",function(i){var f,r,u;return(console.log($("#TicketCreate").valid()),!$("#TicketCreate").valid())?!1:(f=new FormData(t),document.getElementById("tCreateSubmit").disabled="disabled",r=document.getElementById("createPreloader"),r.style.display="block",u=new XMLHttpRequest,u.open("POST",n,!0),u.onreadystatechange=function(){this.readyState===4&&this.status===200?this.status===200?($("#cell-content").html(this.responseText),getCounters()):(onError("Ошибка сохранения"),document.getElementById("tCreateSubmit").disabled="enabled",r.style.display="none"):this.readyState===4&&(onError("Ошибка сохранения:"+this.status),document.getElementById("tCreateSubmit").disabled="enabled",r.style.display="none")},u.send(f),i.preventDefault(),!1)})}function ticketSave(n){var r=document.forms.EditTicket,u=new FormData(r),t=new XMLHttpRequest,i=document.getElementById("editPreloader");i.style.display="block";t.open("POST",n,!0);t.onreadystatechange=function(){this.readyState===4&&(this.status===200?$("#cell-content").html(this.responseText):onError("Ошибка сохранения"))};i.style.display="none";t.send(u);getCounters()}function closed(n,t){$.get("/TicketThreads/IsTask?Id="+n,function(i){if(i==="true"){Metro.infobox.create("<h6>Действие невозможно!<\/h6><p>В заявке имеются не закрытые задачи!","alert");return}table_p="";t&&(table_p="&table=true");openCustomWin("/TicketThreads/Create/"+n+"?Type=1&Event=2"+table_p,"mif-pencil","Закрытие",!0)})}var signalRStart=function(){console.log("signalr client start");const n=(new signalR.HubConnectionBuilder).withUrl("/hub").build();n.on("ReceiveMessage",(n,t,i)=>{Metro.notify.create(i,"Оповещение от "+n+" "+t,{cls:"info",width:300})});n.start().catch(n=>console.error(n.toString()))},closeWin=function(){$(".window").next().remove();$(".overlay").remove();$(".window").remove()},onSuccess=function(n){Metro.notify.create(n,"Удачно",{cls:"success"})},onError=function(n){Metro.notify.create(n,"Ошибка",{cls:"alert"})},end=function(){$("#end").submit()},loadTicketStat=function(n){$.ajax({type:"POST",url:n,contentType:"application/json; charset=utf-8",dataType:"json",success:OnSuccessChart})},OnSuccessChart=function(n){var e=n.data,t=[],i=[];$.map(e,function(n){t.push(n.labels);i.push(n.summ)});var r={labels:t,series:i},u={labelInterpolationFnc:function(n){return n[0]}},f=[["screen and (min-width: 640px)",{chartPadding:30,labelOffset:100,labelDirection:"explode",labelInterpolationFnc:function(n){return n}}],["screen and (min-width: 1024px)",{labelOffset:37,chartPadding:20,labelDirection:"explode",labelInterpolationFnc:function(n){return n}}]];n.type==="C"&&new Chartist.Pie("#catChart",r,u,f);n.type==="S"&&new Chartist.Pie("#statusChart",r,u,f)},loadTicketStatforStaff=function(n){$.ajax({type:"POST",url:n,contentType:"application/json; charset=utf-8",dataType:"json",success:OnSuccessChartforStaff})},OnSuccessChartforStaff=function(n){var t=n,i=[["screen and (max-width: 640px)",{seriesBarDistance:5,axisX:{labelInterpolationFnc:function(n){return n[0]}}}]];new Chartist.Bar("#catChart",t,{seriesBarDistance:10},i)};$(document).ajaxError(function(n,t){t.status===401?window.location="/Account/Login":t.status===403&&alert("You have no enough permissions to request this resource.")});